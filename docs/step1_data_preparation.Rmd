---
title: "Environmental data preparation for habitat suitability mapping"
author: "Lei Song"
date: "5/23/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(sf)
library(terra)
library(stringr)
library(parallel)

# Data path
data_path <- here("data")
```

## Data query/download
### Protected areas
The protected areas are the basic unit for habitat quality analysis and assessment.

```{r}
library(sf)
library(tools)

# Download WDPA file
wdpa_path <- file.path(data_path, "wdpa")
if (!dir.exists(wdpa_path)) dir.create(wdpa_path)

## The url is time sensitive, make sure to get the most recent one on
## https://www.protectedplanet.net/country/TZA
url_dl <- file.path("https://d1gam3xoknrgr2.cloudfront.net",
                    "current/WDPA_WDOECM_May2022_Public_TZA_shp.zip")
fname <- file.path(wdpa_path, basename(url_dl))
download.file(url_dl, destfile = fname)
unzip(fname, exdir = wdpa_path)
file.remove(fname)
rm(url_dl, fname)

# Extract sub-zip files
sub_zips <- list.files(wdpa_path, pattern = ".zip", full.names = TRUE)
fnames <- sapply(sub_zips, function(fname) {
    exdir <- file.path(wdpa_path, file_path_sans_ext(basename(fname)))
    unzip(fname, exdir = exdir)
    file.remove(fname)
    exdir})

# Merge multiple parts
wdpa <- do.call(rbind, lapply(fnames, function(fname) {
    read_sf(list.files(fname, pattern = "polygons.shp", full.names = TRUE))
}))
rm(fnames, sub_zips, wdpa_path)
write_sf(wdpa, file.path(data_path, "wdpa_tanzania.geojson"))
```

### Advanced Land Observing Satellite (ALOS) DSM

DSM is the alternative elevation product of SRTM with approximately 30 meters resolution. 

#### Bounding range of Tanzania

```{r}
# Get the range
bry <- read_sf(file.path(data_path, "tanzania.geojson"))
bry <- bry[, "name"]
ranges <- st_bbox(bry)
ranges[1:2] <- floor(ranges[1:2])
ranges[3:4] <- ceiling(ranges[3:4])
```

#### Target the DSM tiles and download

```{r}
library(terra)

# Get the tiles
## longitude
if (ranges[1] > 0 & ranges[3] >= 0) {
    message("The whole area is in East side.")
    
    start_loc <- ranges[1] %/% 5 * 5
    end_loc <- (ranges[3] %/% 5 + 1) * 5
    lon_zones <- seq(start_loc, end_loc, 5)
    lon_zones <- paste0("E", str_pad(lon_zones, 3, pad = "0"))
} else if (ranges[1] < 0 & ranges[3] >= 0) {
    message("The whole area is across West and East side.")
    
    start_loc <- ranges[1] %/% 5 * 5
    end_loc <- (ranges[3] %/% 5 + 1) * 5
    lon_zones <- seq(start_loc, end_loc, 5)
    lon_signs <- ifelse(lon_zones >= 0, "E", "W")
    lon_zones <- paste0(lon_signs, str_pad(abs(lon_zones), 3, pad = "0"))
    rm(lon_signs)
} else if (ranges[1] < 0 & ranges[3] < 0) {
    message("The whole area is in West side.")
    
    start_loc <- ranges[1] %/% 5 * 5
    end_loc <- (ranges[3] %/% 5 + 1) * 5
    lon_zones <- seq(start_loc, end_loc, 5)
    lon_zones <- paste0("W", str_pad(abs(lon_zones), 3, pad = "0"))
}

## latitude
if (ranges[2] > 0 & ranges[4] >= 0) {
    message("The whole area is in North side.")
    
    start_loc <- ranges[2] %/% 5 * 5
    end_loc <- (ranges[4] %/% 5 + 1) * 5
    lat_zones <- seq(start_loc, end_loc, 5)
    lat_zones <- paste0("N", str_pad(lat_zones, 3, pad = "0"))
} else if (ranges[2] < 0 & ranges[4] >= 0) {
    message("The whole area is across South and North side.")
    
    start_loc <- ranges[2] %/% 5 * 5
    end_loc <- (ranges[4] %/% 5 + 1) * 5
    lat_zones <- seq(start_loc, end_loc, 5)
    lat_signs <- ifelse(lat_zones >= 0, "N", "S")
    lat_zones <- paste0(lat_signs, str_pad(abs(lat_zones), 3, pad = "0"))
    rm(lat_signs)
} else if (ranges[2] < 0 & ranges[4] < 0) {
    message("The whole area is in South side.")
    
    start_loc <- ranges[2] %/% 5 * 5
    end_loc <- (ranges[4] %/% 5 + 1) * 5
    lat_zones <- seq(start_loc, end_loc, 5)
    lat_zones <- paste0("S", str_pad(abs(lat_zones), 3, pad = "0"))
}; rm(ranges, start_loc, end_loc)

zones <- sapply(1:(length(lat_zones) - 1), function(n) {
    sprintf("%s%s_%s%s", lat_zones[n], 
            lon_zones[1:(length(lon_zones) - 1)],
            lat_zones[n + 1], 
            lon_zones[2:length(lon_zones)])})
base_url <- "https://www.eorc.jaxa.jp/ALOS/aw3d30/data/release_v2012"
urls <- file.path(base_url, sprintf("%s.zip", zones))
rm(zones, base_url, lat_zones, lon_zones)

dst_path <- file.path(data_path, "DSM")
if (!dir.exists(dst_path)) dir.create(dst_path)

opts <- options()
options(timeout = 60 * 120)
lapply(urls, function (url_dl) {
    message(sprintf("Download %s to %s", url_dl, dst_path))
    
    # Download
    fname <- file.path(dst_path, basename(url_dl))
    tryCatch({
        download.file(url_dl, 
                  destfile = fname)
    }, error = function(e) {
        warning("Failed to download, try again.")
        file.remove(fname)
        tryCatch({
            download.file(url_dl, 
                  destfile = fname)
        }, error = function(e) {
            warning("Failed to download again.")
            file.remove(fname)})})
    
    # unzip
    if (file.exists(fname)) {
        cmd <- sprintf("unzip %s -d %s", fname, dst_path)
        try(system(cmd, intern = TRUE, ignore.stdout = TRUE))
        file.remove(fname)}
}); options(opts)
rm(bopts, cmd, data_path, fname, url_dl, urls)
```

#### Mosaic to a single file

```{r}
# Mosaic them together
dsm <- do.call(merge, lapply(
    list.files(dst_path, recursive = TRUE, 
               pattern = "DSM.tif", 
               full.names = TRUE), function(fname) {
                   rast(fname)}))
dsm <- crop(dsm, bry)
writeRaster(dsm, file.path(data_path, "dsm_tanzania.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))
```

### Resources (NDVI)

Google Earth Engine to get the mean NDVI and phenology metrics from 2013 - 2018 at 1km, 2km, 4km, 8km, and 10km.

#### Phenology metrics

```{r}
library(sf)
library(googledrive)

# Boundary
bry <- read_sf(file.path(data_path, "tanzania.geojson"))
bry <- vect(bry["name"])

# # 30m
# fnames_gdr <- drive_find(
#     q = "name contains 'lansat8_sr_13_18_NDVI_harmonic_30m'")
# 
# lapply(1:nrow(fnames_gdr), function( n) {
#     fname <- fnames_gdr$name[n]
#     id_to_dl <- fnames_gdr$id[n]
#     message(fname)
#     drive_download(as_id(id_to_dl), 
#                    path = file.path(data_path, "NDVI", fname), 
#                    overwrite = TRUE)
# }); rm(fnames_gdr)
# 
# fnames <- list.files(file.path(data_path, "NDVI"), 
#                      pattern = "harmonic_30m", full.names = TRUE)
# ndvi <- do.call(merge, lapply(fnames, rast))
# ndvi <- mask(ndvi, bry)
# writeRaster(ndvi, file.path(data_path, "ndvi_harmonic_30m.tif"),
#             datatype = "INT4S", overwrite = TRUE,
#             wopt = list(gdal=c("COMPRESS=LZW")))

# 1km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "harmonic_1km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_harmonic_1km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))
rm(ndvi)

# 2km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "harmonic_2km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_harmonic_2km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))
rm(ndvi)

# 4km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "harmonic_4km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_harmonic_4km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))
rm(ndvi)

# 6km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "harmonic_6km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_harmonic_6km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))
rm(ndvi)

# 8km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "harmonic_8km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_harmonic_8km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))
rm(ndvi)

# 10km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "harmonic_10km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_harmonic_10km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))
rm(ndvi)
```

#### Mean NDVI

```{r}
# # 30m
# fnames <- list.files(file.path(data_path, "NDVI"), 
#                      pattern = "mean_30m", full.names = TRUE)
# ndvi <- do.call(merge, lapply(fnames, rast))
# ndvi <- mask(ndvi, bry)
# writeRaster(ndvi, file.path(data_path, "ndvi_harmonic_30m.tif"),
#             datatype = "INT4S", overwrite = TRUE,
#             wopt = list(gdal=c("COMPRESS=LZW")))

# 1km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "mean_1km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_mean_1km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))

# 2km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "mean_2km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_mean_2km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))

# 4km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "mean_4km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_mean_4km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))

# 6km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "mean_6km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_mean_6km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))

# 8km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "mean_8km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_mean_8km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))

# 10km
fname <- list.files(file.path(data_path, "NDVI"), 
                    pattern = "mean_10km", full.names = TRUE)
ndvi <- mask(rast(fname), bry)
writeRaster(ndvi, file.path(data_path, "ndvi_mean_10km.tif"),
            datatype = "INT4S", overwrite = TRUE,
            wopt = list(gdal=c("COMPRESS=LZW")))
rm(bry, ndvi)
```

### Climate and weather

Download from [https://www.worldclim.org/data/worldclim21.html](https://www.worldclim.org/data/worldclim21.html).

```{r}
# Boundary
bry <- read_sf(file.path(data_path, "tanzania.geojson"))
bry <- vect(bry["name"])

fnames <- list.files(file.path(data_path, "wc2"), pattern = ".tif",
                     full.names = TRUE)
wc2 <- do.call(c, lapply(fnames, function(fname) {
    mask(crop(rast(fname), bry), bry)}))

writeRaster(wc2, file.path(data_path, "worldclim2_30s.tif"),
            overwrite = TRUE, wopt = list(gdal=c("COMPRESS=LZW")))
```

### Landscape
#### Natural features

The raw data is downloaded from [https://download.geofabrik.de/africa.html](https://download.geofabrik.de/africa.html).

##### Waterbodies, rivers, and streams

Waterbbodies and deep rivers should act as barriers for animal movement.

```{r}
# Waterbodies
fname <- list.files(file.path(data_path, "osm"),
                    pattern = "osm_water_a_free_1.shp",
                    full.names = TRUE)
waterbodies <- read_sf(fname)
waterbodies <- waterbodies[
    !waterbodies$fclass %in% c("wetland", "glacier", "dock"), ]

# Rivers
fname <- list.files(file.path(data_path, "osm"),
                    pattern = "osm_waterways_free_1.shp",
                    full.names = TRUE)
rivers <- read_sf(fname)
streams <- rivers[rivers$fclass == "stream", ]
rivers <- rivers[rivers$fclass == "river", ]

# Save out
write_sf(waterbodies, file.path(data_path, "waterbodies.geojson"))
write_sf(rivers, file.path(data_path, "rivers.geojson"))
write_sf(streams, file.path(data_path, "streams.geojson"))

# Remove temporary objects
rm(waterbodies, rivers, streams); gc()
```

#### Antropological features
##### Settlement

Here, we use [Google Open Buildings](https://sites.research.google/open-buildings/) for a better quality from [here](https://sites.research.google/open-buildings/#download).

```{r}
# Buildings
fname <- list.files(file.path(data_path, "gob"), full.names = TRUE)

buildings <- read.csv(fname, stringsAsFactors = FALSE)
buildings <- buildings %>% 
  dplyr::select(geometry) %>% 
  dplyr::mutate(geometry = st_as_sfc(geometry)) %>% 
  st_as_sf() %>% st_set_crs(4326) %>% 
  st_make_valid()
buildings <- buildings[!st_is_empty(buildings), , drop = FALSE]

# Save out
write_sf(buildings, file.path(data_path, "buildings.geojson"))
```

##### Roads/railways

```{r}
# Railways
fname <- list.files(file.path(data_path, "osm"),
                    pattern = "osm_railways_free_1.shp",
                    full.names = TRUE)
railways <- read_sf(fname)

# Roads
fname <- list.files(file.path(data_path, "osm"),
                    pattern = "osm_roads_free_1.shp",
                    full.names = TRUE)
roads <- read_sf(fname)

## Remove residential roads
roads <- roads[
    !roads$fclass %in% c("residential", "service", "steps",
                         "pedestrian", "path", "footway", 
                         "cycleway", "living_street"), ]

## Big roads
big_roads <- roads[
    roads$fclass %in% c("trunk", "primary", "secondary", 
                        "tertiary", "trunk_link", "primary_link",
                        "secondary_link", "tertiary_link"), ]
big_roads <- rbind(railways[, c("osm_id", "fclass")], 
                   big_roads[, c("osm_id", "fclass")])

## Other non-motorized roads
## They could be necessary for fine scale analysis
other_roads <- roads[
    !roads$fclass %in% unique(big_roads$fclass), ]

# Save out
write_sf(big_roads, file.path(data_path, "big_roads.geojson"))
write_sf(other_roads, file.path(data_path, "other_roads.geojson"))

# Remove temporary objects
rm(railways, roads, big_roads, other_roads); gc()
```

#### Landcover type
##### Upscaling the original categorical map

```{r}
library(rast)
source(file.path(here(), "scripts/upscale_lc.R"))

# Set original map path
fname <- file.path(data_path, 'landcover.tif')

# Upscaling
dst_fname <- file.path(data_path, 'landcover_1000m.tif')
upscale_lc(fname, 1000, TRUE, dst_fname)
dst_fname <- file.path(data_path, 'landcover_500m.tif')
upscale_lc(fname, 500, TRUE, dst_fname)
dst_fname <- file.path(data_path, 'landcover_250m.tif')
upscale_lc(fname, 250, TRUE, dst_fname)
dst_fname <- file.path(data_path, 'landcover_100m.tif')
upscale_lc(fname, 100, TRUE, dst_fname)
dst_fname <- file.path(data_path, 'landcover_30m.tif')
upscale_lc(fname, 30, TRUE, dst_fname)
rm(fname, dst_fname)
```

## Data pre-processing for upper level 

Prepare environmental variables to do habitat modeling. Use NDVI map as the template to resample just for convenience. And because most of the datasets have projection of 4326, so we also use this projection for all calculation in order to save the processing time.

```{r}
library(here)
library(sf)
library(terra)
library(stringr)
source(file.path(here(), "scripts/ul_var_prep.R"))

scales <- c("1km", "2km", "4km", "6km", "8km", "10km")
lapply(scales, function(scale) {
    message(sprintf("Prepare variables at %s scale.", scale))
    ul_var_prep(data_path, scale)
})
```

## Data-preprocessing for lower scale

### Distances

```{r}
library(terra)
library(rgrass7)

# Distances
## Use GRASS GIS for speed
## set up
gisBase <- '/Applications/GRASS-7.8.app/Contents/Resources'
crs_mer <- crs(rast(file.path(data_path, "ndvi_harmonic_1km.tif")), proj = T)
initGRASS(gisBase = gisBase,
          home = tempdir(),
          gisDbase = tempdir(),  
          mapset = 'PERMANENT', 
          location = 'osm', 
          override = TRUE)
execGRASS("g.proj", flags = "c", 
          proj4 = crs_mer)
execGRASS('r.in.gdal', flags = c("o", "overwrite"),
          input = file.path(data_path, "ndvi_harmonic_1km.tif"),
          band = 1,
          output = "template")
execGRASS("g.region", raster = "template")

# Big roads
big_roads <- read_sf(file.path(data_path, "big_roads.geojson"))
writeVECT(big_roads, 'big_roads', v.in.ogr_flags = 'overwrite')
rm(big_roads)
execGRASS('v.to.rast', flags = c("overwrite"),
                      parameters = list(input = 'big_roads', 
                                        output = 'big_roads',
                                        use = 'val',
                                        value = 1))
execGRASS('r.grow.distance', flags = c("overwrite"),
                      parameters = list(input = 'big_roads', 
                                        distance = 'big_roads'))
execGRASS('r.out.gdal', flags = c("m", "overwrite"),
                      output = file.path(data_path, 
                                         "dist_to_big_roads_1km.tif"),
                      input = "big_roads")

# Other roads
other_roads <- read_sf(file.path(data_path, "other_roads.geojson"))
writeVECT(other_roads, 'other_roads', v.in.ogr_flags = 'overwrite')
rm(other_roads)
execGRASS('v.to.rast', flags = c("overwrite"),
                      parameters = list(input = 'other_roads', 
                                        output = 'other_roads',
                                        use = 'val',
                                        value = 1))
execGRASS('r.grow.distance', flags = c("overwrite"),
                      parameters = list(input = 'other_roads', 
                                        distance = 'other_roads'))
execGRASS('r.out.gdal', flags = c("m", "overwrite"),
                      output = file.path(data_path, 
                                         "dist_to_other_roads_1000m.tif"),
                      input = "other_roads")

# Waterbodies
waterbodies <- read_sf(file.path(data_path, "waterbodies.geojson"))
writeVECT(waterbodies, 'waterbodies', v.in.ogr_flags = 'overwrite')
rm(waterbodies)
execGRASS('v.to.rast', flags = c("overwrite"),
                      parameters = list(input = 'waterbodies', 
                                        output = 'waterbodies',
                                        use = 'val',
                                        value = 1))
execGRASS('r.grow.distance', flags = c("overwrite"),
                      parameters = list(input = 'waterbodies', 
                                        distance = 'waterbodies'))
execGRASS('r.out.gdal', flags = c("m", "overwrite"),
                      output = file.path(data_path, 
                                         "dist_to_waterbodies_1000m.tif"),
                      input = "waterbodies")

# Rivers
rivers <- read_sf(file.path(data_path, "rivers.geojson"))
writeVECT(rivers, 'rivers', v.in.ogr_flags = 'overwrite')
rm(rivers)
execGRASS('v.to.rast', flags = c("overwrite"),
                      parameters = list(input = 'rivers', 
                                        output = 'rivers',
                                        use = 'val',
                                        value = 1))
execGRASS('r.grow.distance', flags = c("overwrite"),
                      parameters = list(input = 'rivers', 
                                        distance = 'rivers'))
execGRASS('r.out.gdal', flags = c("m", "overwrite"),
                      output = file.path(data_path, 
                                         "dist_to_rivers_1000m.tif"),
                      input = "rivers")

# Streams
streams <- read_sf(file.path(data_path, "streams.geojson"))
writeVECT(streams, 'streams', v.in.ogr_flags = 'overwrite')
rm(streams)
execGRASS('v.to.rast', flags = c("overwrite"),
                      parameters = list(input = 'streams', 
                                        output = 'streams',
                                        use = 'val',
                                        value = 1))
execGRASS('r.grow.distance', flags = c("overwrite"),
                      parameters = list(input = 'streams', 
                                        distance = 'streams'))
execGRASS('r.out.gdal', flags = c("m", "overwrite"),
                      output = file.path(data_path, 
                                         "dist_to_streams_1000m.tif"),
                      input = "streams")

# Buildings
buildings <- read_sf(file.path(data_path, "buildings.geojson"))
writeVECT(buildings, 'buildings', v.in.ogr_flags = 'overwrite')
rm(buildings)
execGRASS('v.to.rast', flags = c("overwrite"),
                      parameters = list(input = 'buildings', 
                                        output = 'buildings',
                                        use = 'val',
                                        value = 1))
execGRASS('r.grow.distance', flags = c("overwrite"),
                      parameters = list(input = 'buildings', 
                                        distance = 'buildings'))
execGRASS('r.out.gdal', flags = c("m", "overwrite"),
                      output = file.path(data_path, 
                                         "dist_to_buildings_1000m.tif"),
                      input = "buildings")

# Kernel density of buildings
buildings <- read_sf(file.path(data_path, "buildings.geojson"))
buildings_pts <- st_centroid(buildings); rm(buildings)
writeVECT(buildings_pts, 'buildings', v.in.ogr_flags = 'overwrite')
rm(buildings_pts)
execGRASS('v.kernel', flags = c("overwrite"),
          parameters = list(input = 'buildings', 
                            output = 'buildings_density',
                            radius = 1,
                            node = "split"))
execGRASS('r.out.gdal', flags = c("m", "overwrite"),
                      output = file.path(data_path, 
                                         "buildings_density_1000m.tif"),
                      input = "buildings_density")
```

### Ohters

```{r}
# Landcover type
lc <- rast(file.path(data_path, "landcover_1000m.tif"))
lc <- resample(lc, ndvi[[1]], method = "near")
names(lc) <- "Land_cover"

# Distances
fnames <- list.files(data_path, pattern = "^dist", full.name = TRUE)
dists <- rast(fnames); rm(fnames)
names(dists) <- gsub("_1000m", "", names(dists))
```

